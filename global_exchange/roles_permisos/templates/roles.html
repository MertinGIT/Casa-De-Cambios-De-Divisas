{% extends "baseDashboardUsuario.html" %}
{% load static %}

{% block page_title %}Gestión de Roles{% endblock %}

{% block dashboard_content %}
<div class="card shadow-sm border-0 rounded-3 mt-5" style="margin-inline: 5%;">
  <div class="card-body">

    <div class="d-flex flex-column align-items-start py-2 gap-2">
      <h4 class="fw-bold mb-2">Gestión de Roles</h4>
      <a href="{% url 'rol_nuevo' %}" class="btn btn-primary shadow-sm fw-bold" data-bs-toggle="modal"
        data-bs-target="#roleModal">
        <i class="bi bi-plus-circle"></i> + Nuevo Rol
      </a>
    </div>

    <table class="table table-hover table-striped align-middle mb-0 mt-3" >
      <thead class="table-light"style="color: #0d6efd;">
        <tr>
          <th class="fw-bold">Nombre</th>
          <th class="fw-bold">Descripción</th>
          <th class="fw-bold">Permisos</th>
          <th class="fw-bold text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for rol in roles %}
        <tr>
          <td class="fw-semibold">{{ rol.nombre }}</td>
          <td>{{ rol.descripcion }}</td>
          <td>
            {% for permiso in rol.permisos.all %}
            <span class="badge bg-info text-dark me-1">{{ permiso }}</span>
            {% endfor %}
          </td>
          <td class="text-center">
            <a href="{% url 'rol_editar' rol.id %}" class="btn btn-sm btn-outline-success me-1" data-bs-toggle="modal"
              data-bs-target="#roleModal">
              <i class="bi bi-pencil-square"></i> Editar
            </a>
            <a href="{% url 'rol_eliminar' rol.id %}" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal"
              data-bs-target="#roleModal">
              <i class="bi bi-trash"></i> Eliminar
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center text-muted py-4">
            No hay roles registrados aún.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="roleModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow-lg border-0 rounded-3">
      <!-- aquí se carga rol_modal.html -->
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  const roleModal = document.getElementById('roleModal');
  roleModal.addEventListener('show.bs.modal', function (event) {
    let button = event.relatedTarget;
    let url = button.getAttribute('href');
    fetch(url)
      .then(response => response.text())
      .then(html => {
        roleModal.querySelector('.modal-content').innerHTML = html;
      });
  });
</script>
{% endblock %}