{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Notificaciones de Monedas</title>
    <style>
        @media (max-width: 768px) {
            .notificacion-flotante {
                right: 10px !important;
                left: 10px !important;
                min-width: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Contenedor para notificaciones -->
    <div id="contenedor-notificaciones"></div>

    <script>
        // Funci√≥n que muestra la notificaci√≥n flotante
        function mostrarNotificacion(data) {
            const { moneda, precio_anterior, precio_nuevo, porcentaje_cambio } = data;
            const subio = precio_nuevo > precio_anterior;

            const notif = document.createElement('div');
            notif.className = 'notificacion-flotante';
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                border: 2px solid ${subio ? '#16a34a' : '#dc2626'};
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 8px 24px rgba(0,0,0,0.2);
                z-index: 999999;
                min-width: 320px;
                animation: slideIn 0.3s ease-out;
            `;

            notif.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 2rem;">${subio ? 'üìà' : 'üìâ'}</span>
                        <strong style="font-size: 1.3rem; color: #1e2d70;">${moneda}</strong>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="border: none; background: none; font-size: 1.8rem; cursor: pointer; color: #666; line-height: 1;">
                        √ó
                    </button>
                </div>
                <p style="margin: 10px 0; color: #666; font-weight: 500;">
                    ¬°Cambio de tasa detectado! (${porcentaje_cambio.toFixed(2)}%)
                </p>
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #555;">Anterior:</strong> 
                        <span style="color: #333;">${precio_anterior.toFixed(2)}</span>
                    </div>
                    <div>
                        <strong style="color: #555;">Nuevo:</strong> 
                        <span style="color: ${subio ? '#16a34a' : '#dc2626'}; font-weight: 600;">
                            ${precio_nuevo.toFixed(2)}
                        </span>
                    </div>
                </div>
            `;

            document.getElementById('contenedor-notificaciones').appendChild(notif);

            // Auto cerrar despu√©s de 10 segundos
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notif.remove(), 300);
            }, 10000);
        }

        // Conectar WebSocket
        const socket = new WebSocket("ws://" + window.location.host + "/ws/notificaciones/");

        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            mostrarNotificacion(data);
        };

        socket.onopen = function() {
            console.log("üîó WebSocket conectado correctamente.");
        };

        socket.onerror = function(err) {
            console.error("‚ùå Error en WebSocket:", err);
        };
    </script>
</body>
</html>
