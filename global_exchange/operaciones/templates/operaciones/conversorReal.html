{% extends 'baseDashboardUsuario.html' %} {% load static %} {% load humanize %}
{% block dashboard_content %}
{% include 'notificaciones/modalNotificacion.html' %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<div class="dashboard-grid">
  <!-- COLUMNA IZQUIERDA -->
  <div class="col-left">
    <div class="bloque-izquierdo">
      <!-- Indicadores principales -->
      <section class="indicadores">
        <div class="indicador-card">
          <div class="indicador-icon">
            <i class="icon">📊</i>
          </div>
          <div class="indicador-content">
            <span class="numero">15</span>
            <span class="label">Transacciones totales</span>
            <div class="trend-indicator up">+8.2%</div>
          </div>
        </div>
        <div class="indicador-card">
          <div class="indicador-icon">
            <i class="icon">💰</i>
          </div>
          <div class="indicador-content">
            <span class="numero">1,350 USD</span>
            <span class="label">Ganancia estimada</span>
            <div class="trend-indicator up">+15.3%</div>
          </div>
        </div>
        <div class="indicador-card">
          <div class="indicador-icon">
            <i class="icon">⚡</i>
          </div>
          <div class="indicador-content">
            <span class="numero">Venta</span>
            <span class="label">Última operación</span>
            <div class="trend-indicator neutral">2 min ago</div>
          </div>
        </div>
      </section>

      <!-- Estadísticas rápidas -->
      <section class="estadisticas-rapidas">
        {% include 'operaciones/limites_operaciones.html' %}
      </section>

      <!-- Conversor -->
      <main class="conversor-container">
        <h2 class="title">💱 Conversor de Divisas</h2>
        <form
          id="form-conversor"
          method="post"
          class="conversor-form"
          action="{% url 'operaciones' %}"
        >
          {% csrf_token %}

          <div class="campo fila operacion-toggle">
            <!-- Nota: mantuve los values igual que tenías para no romper la lógica previa:
                 value="venta" corresponde a "Compra (entrego PYG)" en tu UI original -->
            <label class="toggle-label">
              <input type="radio" name="operacion" value="venta" checked />
              Compra (entrego PYG)
            </label>
            <label class="toggle-label">
              <input type="radio" name="operacion" value="compra" /> Venta
              (recibo PYG)
            </label>
          </div>

          <!-- ==== COMPRA (se muestra cuando radio value === "venta") ==== -->
          <!-- ==== COMPRA 1: ORIGEN PYG ==== -->
<!-- ==== COMPRA ==== -->
<div class="campo fila" id="compra-1">
    <div class="input-icon-wrapper">
        <span class="icono">💵</span>

        {% if monedas %}
            <select id="origen-compra" name="origen" class="input-select">
                {% for moneda in monedas %}
                    {% if moneda.abreviacion == "PYG" %}
                        <option value="{{ moneda.abreviacion }}" {% if moneda.abreviacion == origen %}selected{% endif %}>
                            {{ moneda.nombre }} ({{ moneda.abreviacion }})
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        {% else %}
            <select class="input-select" disabled>
                <option selected>No hay monedas disponibles</option>
            </select>
        {% endif %}
    </div>

    <input type="text" id="valor-compra" name="valor" class="input-text" placeholder="Monto" />
</div>

<div class="campo fila" id="compra-2">
    <div class="input-icon-wrapper">
        <span class="icono">💲</span>

        {% if monedas %}
            <select id="destino-compra" name="destino" class="input-select">
                {% for moneda in monedas %}
                    {% if moneda.abreviacion != "PYG" %}
                        <option value="{{ moneda.abreviacion }}" {% if moneda.abreviacion == destino %}selected{% endif %}>
                            {{ moneda.nombre }} ({{ moneda.abreviacion }})
                        </option>
                        
                    {% endif %}
                {% endfor %}
            </select>
        {% else %}
            <select class="input-select" disabled>
                <option selected>No hay monedas disponibles</option>
            </select>
        {% endif %}
    </div>

    <input type="text" id="resultado-compra" name="resultado" class="input-text readonly"
        placeholder="Resultado" readonly value="{{ resultado }}" />
</div>

<!-- ==== VENTA ==== -->
<div class="campo fila" id="venta-1" style="display: none">
    <div class="input-icon-wrapper">
        <span class="icono">💵</span>

        {% if monedas %}
            <select id="origen-venta" name="origen" class="input-select">
                {% for moneda in monedas %}
                    {% if moneda.abreviacion != "PYG" %}
                        <option value="{{ moneda.abreviacion }}" {% if moneda.abreviacion == origen %}selected{% endif %}>
                            {{ moneda.nombre }} ({{ moneda.abreviacion }})
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        {% else %}
            <select class="input-select" disabled>
                <option selected>No hay monedas disponibles</option>
            </select>
        {% endif %}
    </div>

    <input type="text" id="valor-venta" name="valor" class="input-text" placeholder="Monto" />
</div>

<div class="campo fila" id="venta-2" style="display: none">
    <div class="input-icon-wrapper">
        <span class="icono">💲</span>

        {% if monedas %}
            <select id="destino-venta" name="destino" class="input-select">
                {% for moneda in monedas %}
                    {% if moneda.abreviacion == "PYG" %}
                        <option value="{{ moneda.abreviacion }}" {% if moneda.abreviacion == destino %}selected{% endif %}>
                            {{ moneda.nombre }} ({{ moneda.abreviacion }})
                        </option>
                    {% endif %}
                {% endfor %}
            </select>
        {% else %}
            <select class="input-select" disabled>
                <option selected>No hay monedas disponibles</option>
            </select>
        {% endif %}
    </div>

    <input type="text" id="resultado-venta" name="resultado" class="input-text readonly"
        placeholder="Resultado" readonly value="{{ resultado }}" />
</div>

          <button type="submit" id="btn-convertir" class="btn-convertir">
            Realizar transacción
          </button>
        </form>
      </main>
    </div>
  </div>

  <!-- COLUMNA DERECHA -->
  <div class="col-right">
    {% include 'notificaciones/modalNotificacion.html' %}
    <section class="transacciones-container">
      <h2 class="title">🧾 Transacciones Recientes</h2>
      <div class="filtro-transacciones">
        <select id="filtro-columna" class="input-select">
          <option value="fecha">Fecha</option>
          <option value="monto">Monto</option>
          <option value="moneda">Moneda</option>
          <option value="estado">Estado</option>
          <option value="tipo">Tipo</option>
        </select>
        <input
          type="text"
          id="filtro-general"
          placeholder="Buscar..."
          class="input-text"
        />
      </div>

      <table class="tabla-transacciones">
        <thead>
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Monto</th>
            <th>Moneda</th>
            <th>Estado</th>
            <th>Tipo</th>
          </tr>
        </thead>
        <tbody>
          {% for t in transacciones %}
          <tr>
            <td>{{ t.id }}</td>
            <td>{{ t.fecha }}</td>
            <td>{{ t.monto }}</td>
            <td>{{ t.moneda_destino }}</td>
            <td>
              <span class="estado {{ t.estado|lower }}">{{ t.estado }}</span>
            </td>
            <td class="tipo-{{ t.tipo|lower }}">{{ t.tipo }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% include 'operaciones/graficoTransaccion.html' with data_transacciones_json=data_transacciones_json monedas=monedas %}
    </section>
  </div>
</div>

<!-- MODAL Mensajes -->
{% include 'operaciones/modalMensajes.html' %}

<!-- MODAL Metodo Pago -->
{% include 'operaciones/modalMetodoPago.html' %}

<!-- MODAL CONFIRMACIÓN -->
{% include 'operaciones/modalConfirmarTransaccion.html' %}

<!-- MODAL PIN -->
{% include 'operaciones/modalPin.html' %}

<!-- MODAL ÉXITO -->
{% include 'operaciones/modalExito.html' %}

<!-- MODAL MedioAcreditacion -->
{% include 'operaciones/modalMedioAcreditacion.html' %}


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
      $(document).ready(function () {

        const tasaVta = parseFloat("{{ tasa_vta|floatformat:2 }}".replace(",", "."));
        const tasaCmp = parseFloat("{{ tasa_cmp|floatformat:2 }}".replace(",", "."));

        console.log("Tasa Venta:", tasaVta, "Tasa Compra:", tasaCmp);
        console.log("resultado", "{{resultado}}");

        // Muestra/oculta inputs según operación
        function actualizarCamposPorOperacion() {
          const op = $("input[name='operacion']:checked").val();

          if (op === "venta") { // Venta -> "Compra por cliente (entrego PYG)"
            // mostrar compra
            $("#compra-1, #compra-2").show();
            $("#compra-1 select, #compra-1 input, #compra-2 select, #compra-2 input")
              .prop("disabled", false);

            // ocultar venta
            $("#venta-1, #venta-2").hide();
            $("#venta-1 select, #venta-1 input, #venta-2 select, #venta-2 input")
              .prop("disabled", true);

            // forzar origen PYG
            $("#origen-compra").val("PYG").prop("disabled", true);

          } else { // op === "compra" → "Venta (recibo PYG)"
            // mostrar venta
            $("#venta-1, #venta-2").show();
            $("#venta-1 select, #venta-1 input, #venta-2 select, #venta-2 input")
              .prop("disabled", false);

            // ocultar compra
            $("#compra-1, #compra-2").hide();
            $("#compra-1 select, #compra-1 input, #compra-2 select, #compra-2 input")
              .prop("disabled", true);

            // forzar destino PYG
            $("#destino-venta").val("PYG").prop("disabled", true);
          }

          // limpiar resultados
          $("#resultado-compra, #resultado-venta").val("");
        }


        // obtener los elementos relevantes según la operación activa
        function getCampos() {
          const op = $("input[name='operacion']:checked").val();
          if (op === "venta") { // compra inputs activos
            return {
              $origen: $("#origen-compra"),
              $destino: $("#destino-compra"),
              $valor: $("#valor-compra"),
              $resultado: $("#resultado-compra"),
              op
            };
          } else { // venta inputs activos
            return {
              $origen: $("#origen-venta"),
              $destino: $("#destino-venta"),
              $valor: $("#valor-venta"),
              $resultado: $("#resultado-venta"),
              op
            };
          }
        }

        // cálculo instantáneo
        function calcularResultado() {
          const campos = getCampos();
          if (!campos || !campos.$valor) return;

          let raw = campos.$valor.val() || "";
          raw = raw.replace(/[^0-9.]/g, '');
          const parts = raw.split('.');
          if (parts.length > 2) raw = parts.shift() + '.' + parts.join('');
          campos.$valor.val(raw);
          const monto = parseFloat(raw);
          const origenVal = campos.$origen.val();
          const destinoVal = campos.$destino.val();

          if (!monto || monto <= 0 || !origenVal || !destinoVal || origenVal === destinoVal) {
            campos.$resultado.val("");
            return;
          }

          if (!monto || monto <= 0) {
            campos.$resultado.val("");
            return;
          }
          // formateador
           //const formatter = new Intl.NumberFormat("es-ES", {
           //  minimumFractionDigits: 2,
           //  maximumFractionDigits: 2
           //});
          // AJAX para cálculo en el servidor (si tu endpoint responde JSON { resultado, tasa })
          $.ajax({
            url: "{% url 'operaciones' %}",
            type: "POST",
            data: {
              csrfmiddlewaretoken: "{{ csrf_token }}",
              valor: monto,
              operacion: campos.op,
              origen: origenVal,
              destino: destinoVal
            },
            success: function (resp) {
              if (resp && resp.resultado !== undefined) {
                const resultadoNumero = parseFloat(resp.resultado);
                const resultadoFormateado = (resultadoNumero);
                campos.$resultado.val(resultadoFormateado);
                campos.$resultado.data("tasa", resp.tasa);
                campos.$resultado.data("fecha_tasa", resp.fecha_tasa);
              } else {
                let resultadoCalc = campos.op === "venta"
                  ? (monto / tasaVta).toFixed(2)
                  : (monto * tasaCmp).toFixed(2);
                  const resultadoFormateado = (parseFloat(resultadoCalc));
          campos.$resultado.val(resultadoFormateado);

              }
              console.log("resp", resp);
            },
            error: function () {
              let resultadoCalc = campos.op === "venta"
                ? (monto / tasaVta).toFixed(2)
                : (monto * tasaCmp).toFixed(2);
                const resultadoFormateado = (parseFloat(resultadoCalc));
        campos.$resultado.val(resultadoFormateado);
            }
          });
          // cálculo local inmediato
          let resultadoCalc = campos.op === "venta"
            ? (monto / tasaVta).toFixed(2)
            : (monto * tasaCmp).toFixed(2);
            const resultadoFormateado = (parseFloat(resultadoCalc));
    console.log("resultadoCalc formateado:", resultadoFormateado);
    campos.$resultado.val(resultadoFormateado);
        }
        // Init y eventos
        actualizarCamposPorOperacion();
        $(document).on("change", "input[name='operacion']", function () {
          actualizarCamposPorOperacion();
          calcularResultado(); // recalcular si había valor
        });

        // inputs que deben disparar el cálculo
        $(document).on("input change", "#valor-compra, #valor-venta, #destino-compra, #origen-venta", function () {
          calcularResultado();
        });

        function mostrarMensaje(titulo, texto) {
          if (window.mostrarMensajeModal) {
            window.mostrarMensajeModal(titulo, texto);
          } else {
            console.error("Modal mensaje no disponible");
            alert(titulo + ": " + texto);
          }
        }

        
          function validarMonto(monto) {
            // Convertir a string
            const montoStr = monto.toString();

            // Separar parte entera y decimal
            const partes = montoStr.split(".");
            const enteros = partes[0] || "";
            const decimales = partes[1] || "";
            console.log("partes", partes);
            console.log("enteros", enteros);
            console.log("decimales", decimales);

            if (enteros.length > 15) {
                mostrarMensaje("⚠️ Error", "El monto no puede tener más de 15 dígitos antes del punto decimal.");
                return false;
            }

            if (decimales.length > 8) {
                mostrarMensaje("⚠️ Error", "El monto no puede tener más de 8 decimales.");
                return false;
            }

            return true;
          }
        // Declaración global
        window.fechaNavegador = null;
        var advertenciaMostrada = false; // 🔑 Flag para controlar el mensaje
        $(document).ready(function () {
          // Botones modales
          $("#btn-cancelar, .modal .close").click(function () {
            if (advertenciaMostrada) {
              location.reload(); // 🔄 Recargar si ya se mostró la advertencia
            } else {
              $(this).closest(".modal").fadeOut();

            }
            $(".pin-digit").val("");
          });

          // Cuando el usuario hace clic en "Realizar transacción"
          $("#btn-convertir").click(function () {
            obtenerHoraServidor(function (fechaServidor) {
              fechaNavegador = fechaServidor;
              console.log("Hora servidor usada:", fechaNavegador);
            })
          });
            

          // Botón para continuar a pesar de cambio de tasa
          $("#btn-continuar-tasa").click(function () {
            fechaNavegador = new Date(); // actualizamos fecha usada
            $("#mensaje-error-tasa").hide();
            $(this).hide();

          });

          // Nuevo botón para confirmar método de pago
          $("#btn-confirmar").click(function () {
            verificarTasaActualizada(function(tasaActualizada) {
            if (tasaActualizada) {
              //$("#modal-confirmacion").fadeOut();
              //$("#modal-metodo").fadeIn().css("display", "flex");
              console.log("Tasa actualizada, procediendo a método de pago");
            }else{
              $("#modal-exito").hide();
              mostrarMensaje("Transacción Rechazada", "⚠️ La tasa de cambio usada ya no es la más reciente. Tiene que volver a recalcular para usar la última tasa.");
              $("#modal-confirmacion").fadeOut();
            }
            });
          });

          $("#form-metodo-pago").submit(function(e){
            e.preventDefault();
            verificarTasaActualizada(function(tasaActualizada) {

            if (tasaActualizada) {
              $("#modal-confirmacion").fadeOut();
              $("#modal-pin").fadeIn().css("display", "flex");
            }else{
              $("#modal-exito").hide();
              mostrarMensaje("Transacción Rechazada", "⚠️ La tasa de cambio usada ya no es la más reciente. Tiene que volver a recalcular para usar la última tasa.");
              $("#modal-pin").fadeOut();
            }
            });
          });


        });

        function obtenerHoraServidor(callback) {
          $.get("{% url 'hora_servidor' %}", function (resp) {
            const fechaServidor = new Date(resp.hora);
            callback(fechaServidor);
          });
        }

        window.getCookie=function (name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              // Comprueba si la cookie comienza con el nombre deseado
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }

        $(".pin-digit").on("input", function () { let next = $(this).next(".pin-digit"); if (this.value.length && next.length) next.focus(); });

        const PB_MONEDA = "{{ PB_MONEDA }}";
        const tasa_recibida = "{{ tasa }}";
        window.TASA_REF_ID = "{{ TASA_REF_ID }}";

        const monedasMap = {};
        {% for moneda in monedas %}
        monedasMap["{{ moneda.abreviacion }}"] = {{ moneda.id }};
        {% endfor %}

      console.log("Mapa de monedas:", monedasMap);

      // Función para obtener ID por abreviación
      window.obtenerIdMoneda = function(abreviacion) {
        return monedasMap[abreviacion] || null;
      };


      // Función reutilizable para verificar tasas
      function verificarTasaActualizada(callback) {
        const campos = getCampos();
        console.log("Verificando tasa para:", campos.$origen.val(), "->", campos.$destino.val());
        
        $.ajax({
          url: "{% url 'verificar_tasa' %}",
          type: "GET",
          data: {
            origen: campos.op == "venta" ? campos.$origen.val() : campos.$destino.val(),
            destino: campos.op == "venta" ? campos.$destino.val() : campos.$origen.val()
          },
          success: function (resp) {
            const fechaBaseDatos = new Date(resp.fecha_tasa);
            console.log("fechaNavegador:", fechaNavegador);
            console.log("fechaBaseDatos:", fechaBaseDatos);

            if (fechaBaseDatos > fechaNavegador) {
              // ⚠️ La tasa ya cambió
              $("#btn-continuar-tasa").show();   // mostrar botón de recalcular
              $("#btn-confirmar").hide();        // ocultar botón de confirmar
              advertenciaMostrada = true;

              if (callback) callback(false); // avisar que NO puede continuar
              return;
            } else {
              if (callback) callback(true);  // tasa ok
            }
          },
          error: function() {
            console.error("Error al verificar tasa");
            if (callback) callback(true); // En caso de error, permitir continuar
          }
        });
      }

      
      $("#btn-cerrar-exito").click(function () {
        $("#modal-exito").fadeOut();
        $(".input-text").val("");
      });

      // Filtro tabla
      function aplicarFiltroUnico() {
        const columna = $('#filtro-columna').val(), query = $('#filtro-general').val().toLowerCase();
        $('.tabla-transacciones tbody tr').each(function () {
          const t = $(this); let valor = '';
          switch (columna) {
            case 'fecha': valor = t.find('td:nth-child(2)').text().toLowerCase(); break;
            case 'monto': valor = t.find('td:nth-child(3)').text().toLowerCase(); break;
            case 'moneda': valor = t.find('td:nth-child(4)').text().toLowerCase(); break;
            case 'estado': valor = t.find('td:nth-child(5)').text().toLowerCase(); break;
            case 'tipo': valor = t.find('td:nth-child(6)').text().toLowerCase(); break;
          }
          t.toggle(valor.includes(query));
        });
      }
      $('#filtro-general, #filtro-columna').on('input change', aplicarFiltroUnico);

    });
</script>

<style>
  .dashboard-grid {
    display: grid;
    grid-template-columns: minmax(300px, 1fr) minmax(350px, 1.2fr);
    gap: 2rem;
    max-width: 1400px;
    margin: 2rem auto;
  }
  .col-left {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .col-right {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .bloque-izquierdo {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    justify-content: center;
  }
  .conversor-container {
    padding: 1.5rem;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    text-align: center;
  }
  .title {
    color: #1e2d70;
    margin-bottom: 1rem;
    font-size: 1.4rem;
    font-weight: 600;
  }
  .conversor-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .fila {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .input-select,
  .input-text {
    padding: 0.6rem 0.8rem;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-size: 0.95rem;
    flex: 1;
  }
  .input-text.readonly {
    background: #f4f6fb;
    color: #555;
    cursor: not-allowed;
  }
  .btn-convertir {
    background: #5d5fef;
    color: #fff;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    padding: 0.8rem;
    cursor: pointer;
    transition: 0.3s;
  }
  .btn-convertir:hover {
    background: #4a4cd9;
  }
  .operacion-toggle {
    justify-content: center;
    gap: 1rem;
    display: flex;
    margin-bottom: 0.5rem;
  }
  .toggle-label {
    cursor: pointer;
    font-weight: 500;
  }
  .toggle-label input {
    margin-right: 0.3rem;
  }
  .input-icon-wrapper {
    position: relative;
  }
  .input-icon-wrapper .icono {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2rem;
    pointer-events: none;
  }
  .input-icon-wrapper .input-select {
    padding-left: 35px;
  }
  .transacciones-container {
    padding: 1.5rem;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    height: 100%;
  }
  .tabla-transacciones {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }
  .tabla-transacciones th,
  .tabla-transacciones td {
    padding: 0.8rem;
    border-bottom: 1px solid #eee;
    text-align: center;
    font-size: 0.9rem;
  }
  .tabla-transacciones tbody tr:nth-child(even) {
    background: #f9f9f9;
  }
  .tabla-transacciones td.tipo-compra::before {
    content: "🟢 ";
  }
  .tabla-transacciones td.tipo-venta::before {
    content: "🔴 ";
  }
  .estado.completado {
    color: #16a34a;
    font-weight: 600;
  }
  .estado.pendiente {
    color: #ca8a04;
    font-weight: 600;
  }
  .estado.cancelado {
    color: #dc2626;
    font-weight: 600;
  }
  .indicadores {
    display: flex;
    justify-content: space-around;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
  }
  .indicador {
    text-align: center;
  }
  .indicador .numero {
    font-size: 1.3rem;
    font-weight: 600;
    color: #1e2d70;
  }
  .indicador .label {
    font-size: 0.85rem;
    color: #555;
  }
  .estadisticas-rapidas {
    padding: 1rem;
    background: #f9f9f9;
    border-radius: 12px;
  }
  .estadisticas-rapidas h3 {
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
    color: #1e2d70;
  }
  .filtro-transacciones {
    display: flex;
    gap: 0.5rem;
    margin: 1rem 0;
  }
  .filtro-transacciones .input-select,
  .filtro-transacciones .input-text {
    flex: 1;
    padding: 0.6rem 0.8rem;
    border-radius: 10px;
    border: 1px solid #ddd;
  }
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 99999;
  }
  
  #mensaje-pin {
    display: none;
    font-weight: 600;
    color: red;
    margin-bottom: 0.5rem;
  }
  .pin-container {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  .pin-container .pin-digit {
    width: 50px;
    height: 50px;
    text-align: center;
    font-size: 1.4rem;
    border: 1px solid #ddd;
    border-radius: 8px;
  }
  .indicador-card {
    background: #fff;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(30, 45, 112, 0.1);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .indicador-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  }

  .indicador-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #5d5fef, #4a4cd9);
  }

  .indicador-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #f4f6fb, #e8ecf7);
    border-radius: 12px;
    font-size: 1.5rem;
  }

  .indicador-content {
    flex: 1;
  }

  .numero {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    color: #1e2d70;
    margin-bottom: 0.25rem;
  }

  .trend-indicator {
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 0.25rem;
  }

  .trend-indicator.up {
    color: #16a34a;
  }

  .trend-indicator.neutral {
    color: #666;
  }

  @media (max-width: 992px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }
    .fila {
      flex-direction: column;
      align-items: stretch;
      gap: 0.5rem;
    }
    .input-icon-wrapper .input-select {
      width: 100%;
    }
    .indicadores {
      flex-wrap: wrap;
      justify-content: center;
    }
    .indicador {
      flex: 1 1 45%;
      margin-bottom: 1rem;
    }
    .col-right {
      margin-top: 2rem;
    }
  }
</style>

{% endblock %}