<!-- MODAL MÉTODO DE PAGO -->
<div id="modal-metodo" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3>Seleccione un método de pago</h3>
    <form id="form-metodo-pago">
      <div id="lista-metodos" class="lista-metodos">
        {% for medio in medios %}
        <label>
          <input type="radio" name="medio" value="{{ medio.id }}">
          {{ medio.tipo|capfirst }}: {{ medio.nombre }} ({{ medio.moneda }}) - Saldo: {{ medio.saldo }}
        </label>
        {% empty %}
        <p>No hay medios de pago disponibles.</p>
        {% endfor %}
      </div>

      <div id="info-extra" style="display:none; margin-top:1rem;">
        <label>Detalles adicionales:</label>
        <textarea id="detalle-pago" rows="3" placeholder="Datos de cuenta, tarjeta, etc."></textarea>
      </div>

      <button type="submit" class="btn-confirmar">Confirmar Método</button>
    </form>
  </div>
</div>

<style>
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.modal-content {
  background:#fff;
  padding:2rem 1.5rem;
  border-radius:12px;
  max-width:400px;
  width:90%;
  position:relative;
  box-shadow:0 6px 20px rgba(0,0,0,0.25);
}
.modal-content .close {
  position:absolute;
  top:10px;
  right:15px;
  font-size:1.5rem;
  font-weight:bold;
  color:#555;
  cursor:pointer;
}
.modal-content .close:hover { color:#dc2626; }

.lista-metodos label {
  display:block;
  padding:0.5rem;
  border:1px solid #ddd;
  border-radius:8px;
  margin-bottom:0.5rem;
  cursor:pointer;
}
.lista-metodos input { margin-right:0.5rem; }

.btn-confirmar {
  margin-top:1rem;
  padding:0.7rem 1rem;
  border:none;
  border-radius:10px;
  background:#16a34a;
  color:#fff;
  cursor:pointer;
  transition:0.3s;
}
.btn-confirmar:hover { background:#15803d; }
</style>

<script>
$(document).ready(function(){

  // Abrir modal al confirmar transacción
  $("#btn-confirmar").click(function(){
      $("#modal-confirmacion").fadeOut();
      $("#modal-metodo").fadeIn().css("display","flex");
  });

  // Cerrar modal con la X
  $(".modal .close").click(function(){
      $(this).closest(".modal").fadeOut();
  });

  // Mostrar detalles extra según tipo de medio
  $("#lista-medios input[name='medio']").change(function(){
      let labelText = $(this).parent().text().toLowerCase();
      if(labelText.includes("tarjeta") || labelText.includes("billetera")){
          $("#info-extra").slideDown();
      } else {
          $("#info-extra").slideUp();
      }
  });

  // Confirmar método de pago y generar JSON simulado
  $("#form-metodo-pago").submit(function(e){
      e.preventDefault();

      let medioId = $("input[name='medio']:checked").val();
      if(!medioId){
          alert("Seleccione un medio de pago");
          return;
      }

      let detalles = $("#detalle-pago").val();

      $("#modal-metodo").fadeOut();
      $("#modal-pin").fadeIn().css("display","flex");

      // Datos estáticos simulados
      const mediosSimulados = {
          "1": {nombre: "Tarjeta Banco XYZ", tipo: "tarjeta", moneda: "USD", saldo: 1000},
          "2": {nombre: "Efectivo", tipo: "efectivo", moneda: "PYG", saldo: 5000000},
          "3": {nombre: "Billetera Digital", tipo: "billetera", moneda: "USD", saldo: 300}
      };

      let medioSeleccionado = mediosSimulados[medioId] || {nombre:"Desconocido", tipo:"desconocido", moneda:"USD", saldo:0};

      // Generamos JSON de la "transferencia"
      let transferencia = {
          medio_id: medioId,
          nombre: medioSeleccionado.nombre,
          tipo: medioSeleccionado.tipo,
          moneda: medioSeleccionado.moneda,
          saldo_disponible: medioSeleccionado.saldo,
          monto: 5000,   // monto simulado
          detalles: detalles || ""
      };

      console.log("Transacción simulada:", JSON.stringify(transferencia, null, 2));
  });

});
</script>
