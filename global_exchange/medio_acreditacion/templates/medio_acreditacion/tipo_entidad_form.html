{% extends "base_forms.html" %}
{% load widget_tweaks %}
{% block form_fields %}

<div class="form-group">
    <label for="{{ form.nombre.id_for_label }}">Nombre *</label>
    <div class="input-icon">
        <span class="icon">üè¶</span>
        {{ form.nombre|add_class:"custom-input" }}
    </div>
    <div class="error-messages"></div>
</div>
<div class="form-group">
    <label for="{{ form.tipo.id_for_label }}">Tipo *</label>
    <div class="input-icon">
        <span class="icon">üè∑Ô∏è</span>
        {{ form.tipo|add_class:"custom-input" }}
    </div>
    <div class="error-messages"></div>
</div>
<div class="form-group">
    <label for="{{ form.comision.id_for_label }}">Comisi√≥n (%)</label>
    <div class="input-icon">
        <span class="icon">üí∞</span>
        {{ form.comision|add_class:"custom-input" }}
    </div>
    <div class="error-messages"></div>
</div>
<style>
    .custom-input {
        width: 100%;
        padding: 8px 12px 8px 36px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        background-color: #f0edff;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .custom-input::placeholder {
        color: #6b7280;
    }

    .custom-input:focus {
        border-color: #5d5fef;
        box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.1);
    }

    .custom-input.error {
        border-color: #ef4444 !important;
        background-color: #fef2f2;
    }

    .custom-input.valid {
        border-color: #10b981;
        background-color: #f0fdf4;
    }

    .input-icon {
        position: relative;
        margin-bottom: 4px;
    }

    .input-icon .icon {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        font-size: 16px;
        color: #5d5fef;
        z-index: 1;
    }

    .error-messages {
        min-height: 18px;
        margin-bottom: 8px;
        display: block;
    }

    .error-messages .error-message {
        color: #ef4444 !important;
        font-size: 12px !important;
        font-weight: normal !important;
        margin: 2px 0 !important;
        padding: 0 !important;
        display: block !important;
        background: none !important;
        border: none !important;
        text-align: left !important;
        line-height: 1.4 !important;
        animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script>
    let tipoEntidadValidator = null;
    jQuery.extend(jQuery.validator.messages, {
        required: "Este campo es obligatorio.",
        minlength: jQuery.validator.format("Por favor, no escribas menos de {0} caracteres."),
        maxlength: jQuery.validator.format("Por favor, no escribas m√°s de {0} caracteres.")
    });
    function setupTipoEntidadValidation() {
        const $form = $("#form-accion");
        if (!$form.length) return null;
        if (tipoEntidadValidator) { tipoEntidadValidator.destroy(); tipoEntidadValidator = null; }
        tipoEntidadValidator = $form.validate({
            rules: {
                nombre: { required: true, minlength: 2, maxlength: 100 },
                tipo: { required: true },
                comision: { required: true, number: true, min: 0 },
            },
            messages: {
                nombre: { required: "El nombre es obligatorio", minlength: "M√≠nimo 2 caracteres", maxlength: "M√°ximo 100" },
                tipo: { required: "Debe seleccionar un tipo" },
                comision: { required: "La comisi√≥n es obligatoria", number: "Debe ser un n√∫mero", min: "No puede ser menor que 0" },
            },
            errorElement: 'div',
            errorClass: 'error-message',
            validClass: 'valid',
            errorPlacement: function (error, element) {
                let formGroup = element.closest('.form-group');
                let errorContainer = formGroup.find('.error-messages');
                if (!errorContainer.length) errorContainer = $('<div class="error-messages"></div>').appendTo(formGroup);
                errorContainer.html(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('error').removeClass(validClass);
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('error').addClass(validClass);
            },
            success: function (label, element) {
                $(element).closest('.form-group').find('.error-messages').empty();
            },
            submitHandler: function (form) {
                form.submit();
            },
            invalidHandler: function (event, validator) {
                // Opcional: log de errores
            }
        });
        return tipoEntidadValidator;
    }
    $(document).ready(function () {
        setupTipoEntidadValidation();
    });
</script>
{% endblock %}