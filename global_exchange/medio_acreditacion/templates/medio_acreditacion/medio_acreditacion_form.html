{% extends "base_forms.html"%}
{% load widget_tweaks %}
{% block form_fields %}
{% if cliente %}
<input type="hidden" name="cliente_id" value="{{ cliente.id }}">
{% else %}
<div class="form-group">
  <label for="{{ form.cliente.id_for_label }}">Cliente *</label>
  {{ form.cliente|add_class:"form-control custom-input" }}
  <div class="error-messages"></div>
</div>
{% endif %}
<div class="form-group">
  <label for="{{ form.entidad.id_for_label }}">Entidad Financiera *</label>
  {{ form.entidad|add_class:"form-control" }}
  {% for error in form.entidad.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>
<div class="form-group">
  <label for="{{ form.numero_cuenta.id_for_label }}">Número de Cuenta/Teléfono *</label>
  {{ form.numero_cuenta|add_class:"form-control" }}
  {% for error in form.numero_cuenta.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>
<div class="form-group">
  <label for="{{ form.tipo_cuenta.id_for_label }}">Tipo de Cuenta *</label>
  {{ form.tipo_cuenta|add_class:"form-control" }}
  {% for error in form.tipo_cuenta.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>
<div class="form-group">
  <label for="{{ form.titular.id_for_label }}">Titular *</label>
  {{ form.titular|add_class:"form-control" }}
  {% for error in form.titular.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>
<div class="form-group">
  <label for="{{ form.documento_titular.id_for_label }}">Documento del Titular</label>
  {{ form.documento_titular|add_class:"form-control" }}
  {% for error in form.documento_titular.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>
<div class="form-group">
  <label for="{{ form.moneda.id_for_label }}">Moneda *</label>
  {{ form.moneda|add_class:"form-control" }}
  {% for error in form.moneda.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
</div>

<style>
  .custom-input {
    width: 100%;
    padding: 8px 12px 8px 36px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    background-color: #f0edff;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .custom-input::placeholder {
    color: #6b7280;
  }

  .custom-input:focus {
    border-color: #5d5fef;
    box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.1);
  }

  .custom-input.error {
    border-color: #ef4444 !important;
    background-color: #fef2f2;
  }

  .custom-input.valid {
    border-color: #10b981;
    background-color: #f0fdf4;
  }

  .input-icon {
    position: relative;
    margin-bottom: 4px;
  }

  .input-icon .icon {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    font-size: 16px;
    color: #5d5fef;
    z-index: 1;
  }

  .error-messages {
    min-height: 18px;
    margin-bottom: 8px;
    display: block;
  }

  .error-messages .error-message {
    color: #ef4444 !important;
    font-size: 12px !important;
    font-weight: normal !important;
    margin: 2px 0 !important;
    padding: 0 !important;
    display: block !important;
    background: none !important;
    border: none !important;
    text-align: left !important;
    line-height: 1.4 !important;
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script>
  jQuery.extend(jQuery.validator.messages, {
    required: "Este campo es obligatorio.",
    number: "Ingrese un número válido.",
    minlength: jQuery.validator.format("Debe tener al menos {0} caracteres."),
  });
  function setupMedioAcreditacionValidation() {
    const $form = $("#medio-acreditacion-form");
    if (!$form.length) return;
    $form.validate({
      rules: {
        entidad: { required: true },
        numero_cuenta: { required: true },
        tipo_cuenta: { required: true },
        titular: { required: true },
        documento_titular: {},
        moneda: { required: true }
      },
      messages: {
        entidad: { required: "Debes seleccionar una entidad financiera." },
        numero_cuenta: { required: "Debes ingresar el número de cuenta/teléfono." },
        tipo_cuenta: { required: "Debes seleccionar el tipo de cuenta." },
        titular: { required: "Debes ingresar el titular." },
        moneda: { required: "Debes seleccionar la moneda." }
      },
      errorElement: "div",
      errorClass: "error-message",
      validClass: "valid",
      errorPlacement: function (error, element) {
        let formGroup = element.closest(".form-group");
        let errorContainer = formGroup.find(".error-messages");
        if (!errorContainer.length) {
          errorContainer = $('<div class="error-messages"></div>').appendTo(formGroup);
        }
        errorContainer.append(error);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass("error custom-input").removeClass(validClass);
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass("error").addClass(validClass);
      },
      success: function (label, element) {
        $(element).closest(".form-group").find(".error-messages").empty();
      },
      submitHandler: function (form) {
        form.submit();
      },
      invalidHandler: function (event, validator) {
        console.log("Formulario inválido, errores:", validator.numberOfInvalids());
      }
    });
  }
  $(document).ready(function () {
    setupMedioAcreditacionValidation();
  });
</script>
{% endblock %}